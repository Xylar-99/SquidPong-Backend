generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}


// =============== Enums ===============
enum UserStatus {
  ONLINE
  OFFLINE
}

enum UserCustomStatus {
  ONLINE
  IDLE
  DO_NOT_DISTURB
}
enum NotificationStatus {
  UNREAD
  READ
  ARCHIVED
  DELETED
}


enum NotificationType {
  INFO
  WARNING
  FRIEND_REQUEST
  FRIEND_REQUEST_ACCEPTED
  GAME_INVITE
  TOURNAMENT_UPDATE
  COIN_GIFT_RECEIVED
  ACHIEVEMENT_UNLOCKED
  SPECTATE_INVITE
  PREDICTION_WON
}



model User {
  id          String   @id @default(cuid())

  userId      String   @unique
  username    String   
  firstName   String
  lastName    String
  isVerified  Boolean  @default(false)
  avatar      String   @default("")

  status      UserStatus   @default(OFFLINE)
  customStatus  UserCustomStatus   @default(ONLINE)

  isDeleted   Boolean  @default(false)

  notificationsBy Notification[] @relation("NotificationBy")
  
  notificationSettings   NotificationSettings?
  createdAt   DateTime @default(now())
}



model NotificationSettings {
  id                String @id @default(cuid())
  preferencesId     String @unique

  friendRequests    Boolean @default(true)
  chatMessages      Boolean @default(true)
  gameInvites       Boolean @default(true)
  tournamentUpdates Boolean @default(true)

  preferences User @relation(fields: [preferencesId], references: [id], onDelete: Cascade)
}




model FriendRequest {
  id          String   @id @default(cuid())

  requestId   String
  
  status      String
  message     String?

  payload     Payload  @relation(fields: [payloadId], references: [id], onDelete: Cascade)
  payloadId   Int      @unique

  createdAt   DateTime @default(now())
}



model Payload {
  id                Int       @id @default(autoincrement())

  // General messages
  info              String?
  warning           String?

  // Friend request relation
  friendRequest     FriendRequest?

  // Game related
  gameId            String?

  // Tournament related
  tournamentName    String?
  tournamentId      String?

  // Achievement related
  achievementId     String?
  achievementName   String?

  // Coin related
  coinAmount        Int?

  // Spectate related
  spectateGameId    String?

  // Prediction related
  predictionId      String?
  winningsAmount    Int?

  notificationId    Int          @unique
  notification      Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  createdAt         DateTime     @default(now())
}



model Notification {
  id        Int      @id @default(autoincrement())

  targetId    String
  
  byId      String       
  by      User    @relation("NotificationBy", fields: [byId], references: [userId], onDelete: Cascade)

  type      NotificationType   @default(INFO)
  isRead    Boolean            @default(false)
  createdAt DateTime @default(now())

  payload   Payload?

  updatedAt DateTime @updatedAt
}
