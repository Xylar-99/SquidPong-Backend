generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UserStatus {
  ONLINE
  OFFLINE
  IDLE
  DO_NOT_DISTURB
  INVISIBLE
}

enum RankDivision {
  IRON
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
  ASCENDANT
  IMMORTAL
  MASTER
}


enum RankTier {
  I
  II
  III
}


enum AIDifficulty {
  EASY
  MEDIUM
  HARD
}


enum FriendshipStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}


enum MatchStatus {
  WAITING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum GameMode {
  CLASSIC
  TOURNAMENT
  VS_AI
  BOUNCE_CHALLENGE
}


enum MatchResult {
  WIN
  LOSS
  DRAW
}


enum PlayerCharacter {
  Tbib
  Med
  Ryu
  Younajja
  Mnachit
  Mira
  Zero
  Zenitsu
  Xylar
}

enum PlayerPaddle {
  Boss
  Survivor
  Guard
  Army
}

enum PaddleColor {
  Red
  Blue
  Yellow
  Orange
  Purple
}



// Main Profile model
model Profile {
  id        String       @id @default(cuid())

  userId    Int           @unique
  username  String        @unique 
  firstName String
  lastName  String

  status       UserStatus   @default(OFFLINE)  // Actual connection state (ONLINE/OFFLINE)
  customStatus UserStatus   @default(ONLINE)   // User's preferred display status
  
  lastSeen     DateTime     @default(now())
  avatar       String        @default("/uploads/user/avatar/default.png")
  banner       String        @default("http://localhost:4000/api/user/banners/default.png")
  
  bio          String        @default("Just here to have fun, level up, and make some epic memories!")

  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  isVerified    Boolean    @default(false)
  isDeleted     Boolean    @default(false)
  
  walletBalance Int        @default(0)
  level         Float        @default(0)
  score         Int        @default(0)
  rankDivision  RankDivision @default(BRONZE)
  rankTier      RankTier   @default(I)

  preferences         ProfilePreferences?

  playerCharacters   Json @default("[\"Tbib\"]")
  playerSelectedCharacter PlayerCharacter @default(Tbib)

  playerPaddles Json @default("[\"Boss\"]")
  playerSelectedPaddle    PlayerPaddle @default(Boss)
  paddleColor             PaddleColor   @default(Red)
}





// Profile preferences
model ProfilePreferences {
  id               String @id @default(cuid())
  profileId        String @unique

  soundEnabled     Boolean @default(true)
  musicEnabled     Boolean @default(true)
  twoFactorEnabled Boolean @default(false)

  profile       Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  notifications NotificationSettings?
}



// Notification settings
model NotificationSettings {
  id                String @id @default(cuid())
  preferencesId     String @unique

  friendRequests    Boolean @default(true)
  chatMessages      Boolean @default(true)
  gameInvites       Boolean @default(true)
  tournamentUpdates Boolean @default(true)

  preferences ProfilePreferences @relation(fields: [preferencesId], references: [id], onDelete: Cascade)
}



model Friendship {
  id        String @id @default(cuid())

  senderId    Int
  receiverId  Int
  status      FriendshipStatus @default(PENDING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([senderId, receiverId])
}

// Dedicated Blocked Users Table - Directional blocking system
model BlockedUser {
  id        String   @id @default(cuid())

  blockerId Int      // User who initiated the block
  blockedId Int      // User who is being blocked
  isBlocked Boolean  @default(true)
  
  blockedAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
}






