generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UserStatus {
  ONLINE
  OFFLINE
  IDLE
  DO_NOT_DISTURB
}

enum RankTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
  MASTER
  GRANDMASTER
}


enum RankDivision {
  I
  II
  III
  IV
  V
}


enum AIDifficulty {
  EASY
  MEDIUM
  HARD
}


enum FriendshipStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}


enum MatchStatus {
  WAITING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum GameMode {
  CLASSIC
  TOURNAMENT
  VS_AI
  BOUNCE_CHALLENGE
}


enum MatchResult {
  WIN
  LOSS
  DRAW
}


enum TournamentStatus {
  REGISTRATION
  IN_PROGRESS
  COMPLETED
  CANCELLED
}


// Main Profile model
model Profile {
  id        String       @id @default(cuid())

  userId    Int          @unique
  username  String       
  firstName String
  lastName  String

  status    UserStatus   @default(ONLINE)
  lastSeen  DateTime     @default(now())
  avatar    String        @default("testing.png")
  banner    String        @default("testing.png")
  bio       String        @default("Just here to have fun, level up, and make some epic memories!")
  

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  isVerified    Boolean    @default(false)
  walletBalance Int        @default(0)
  level         Int        @default(1)
  rankDivision  RankDivision @default(V)
  rankTier      RankTier   @default(BRONZE)



  // Relationships
  preferences       ProfilePreferences?
  playerStats       PlayerStats?
  ownedCharacters   ProfileCharacter[]
  selectedCharacter GameCharacter? @relation("SelectedCharacter", fields: [selectedCharacterId], references: [id])
  selectedCharacterId String?

  ownedPaddles      ProfilePaddle[]
  selectedPaddle    Paddle? @relation("SelectedPaddle", fields: [selectedPaddleId], references: [id])
  selectedPaddleId  String?

  playerMatches    Match[] @relation("MatchPlayer")
  createdMatches   Match[] @relation("MatchCreator")
  matchHistory     ProfileMatchHistory[]
  tournamentEntries TournamentEntry[]

  // Friendships
  sentFriendRequests     Friendship[] @relation("SentFriendRequests")
  receivedFriendRequests Friendship[] @relation("ReceivedFriendRequests")
}























// Profile preferences
model ProfilePreferences {
  id               String @id @default(cuid())
  profileId        String @unique
  soundEnabled     Boolean @default(true)
  musicEnabled     Boolean @default(true)
  twoFactorEnabled Boolean @default(false)

  profile       Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  notifications NotificationSettings?
}

// Notification settings
model NotificationSettings {
  id                String @id @default(cuid())
  preferencesId     String @unique
  friendRequests    Boolean @default(true)
  chatMessages      Boolean @default(true)
  gameInvites       Boolean @default(true)
  tournamentUpdates Boolean @default(true)

  preferences ProfilePreferences @relation(fields: [preferencesId], references: [id], onDelete: Cascade)
}

// Player statistics
model PlayerStats {
  id        String @id @default(cuid())
  profileId String @unique

  score Int @default(0)
  rank  Int @default(0)

  gamesPlayed Int @default(0)
  gamesWon    Int @default(0)
  gamesLost   Int @default(0)

  tournamentsPlayed Int @default(0)
  tournamentsWon    Int @default(0)
  tournamentsLost   Int @default(0)

  winStreak        Int @default(0)
  loseStreak       Int @default(0)
  longestWinStreak Int @default(0)

  averageGameDuration Int @default(0)
  totalPlayTime       Int @default(0)
  friendsCount        Int @default(0)

  bounceChallengeBestScore   Int @default(0)
  bounceChallengeGamesPlayed Int @default(0)

  profile   Profile     @relation(fields: [profileId], references: [id], onDelete: Cascade)
  vsAIStats VSAIStats[]
  
  
}

// AI statistics
model VSAIStats {
  id            String @id @default(cuid())
  playerStatsId String
  difficulty    AIDifficulty
  gamesPlayed   Int @default(0)
  gamesWon      Int @default(0)
  gamesLost     Int @default(0)

  playerStats PlayerStats @relation(fields: [playerStatsId], references: [id], onDelete: Cascade)

  @@unique([playerStatsId, difficulty])
}

// Game Character model
model GameCharacter {
  id          String @id @default(cuid())
  name        String @unique
  description String?
  imageUrl    String
  price       Int    @default(0)
  isDefault   Boolean @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profileCharacters ProfileCharacter[]
  selectedByProfiles Profile[] @relation("SelectedCharacter")

}

// Junction table for profile-owned characters
model ProfileCharacter {
  id          String @id @default(cuid())
  profileId   String
  characterId String
  purchasedAt DateTime @default(now())

  profile   Profile       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  character GameCharacter @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@unique([profileId, characterId])
}



// Paddle model
model Paddle {
  id          String @id @default(cuid())
  name        String @unique
  description String?
  imageUrl    String
  price       Int    @default(0)
  isDefault   Boolean @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profilePaddles    ProfilePaddle[]
  selectedByProfiles Profile[] @relation("SelectedPaddle")

}

// Junction table for profile-owned paddles
model ProfilePaddle {
  id          String @id @default(cuid())
  profileId   String
  paddleId    String
  purchasedAt DateTime @default(now())

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  paddle  Paddle  @relation(fields: [paddleId], references: [id], onDelete: Cascade)

  @@unique([profileId, paddleId])
}


// Match system
model Match {
  id          String @id @default(cuid())
  creatorId   String
  status      MatchStatus @default(WAITING)
  gameMode    GameMode
  startTime   DateTime?
  endTime     DateTime?
  winnerId    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  creator       Profile @relation("MatchCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  players       Profile[] @relation("MatchPlayer")
  profileHistory ProfileMatchHistory[]
}


// Profile match history junction
model ProfileMatchHistory {
  id        String @id @default(cuid())
  profileId String
  matchId   String
  result    MatchResult
  score     Int @default(0)

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  match   Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([profileId, matchId])
}

// Tournament system
model Tournament {
  id          String @id @default(cuid())
  name        String
  description String?
  maxPlayers  Int
  prizePool   Int @default(0)
  status      TournamentStatus @default(REGISTRATION)
  startTime   DateTime
  endTime     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  entries TournamentEntry[]

}

model TournamentEntry {
  id           String @id @default(cuid())
  profileId    String
  tournamentId String
  position     Int?
  joinedAt     DateTime @default(now())

  profile    Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)
  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([profileId, tournamentId])
}



// Friendship system
model Friendship {
  id        String @id @default(cuid())

  senderId  String
  receiverId String
  status    FriendshipStatus @default(PENDING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender   Profile @relation("SentFriendRequests", fields: [senderId], references: [id], onDelete: Cascade)
  receiver Profile @relation("ReceivedFriendRequests", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
}
