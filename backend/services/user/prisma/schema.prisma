generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UserStatus {
  ONLINE
  OFFLINE
  IDLE
  DO_NOT_DISTURB
}

enum RankTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
  MASTER
}


enum RankDivision {
  I
  II
  III
}


enum AIDifficulty {
  EASY
  MEDIUM
  HARD
}


enum FriendshipStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}


enum MatchStatus {
  WAITING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum GameMode {
  CLASSIC
  TOURNAMENT
  VS_AI
  BOUNCE_CHALLENGE
}


enum MatchResult {
  WIN
  LOSS
  DRAW
}


enum TournamentStatus {
  REGISTRATION
  IN_PROGRESS
  COMPLETED
  CANCELLED
}


enum PlayerCharacter {
  WARRIOR
  MAGE
  ARCHER
  ASSASSIN
}

enum PlayerPaddle {
  WOODEN
  METAL
  GOLDEN
  DIAMOND
}


// Main Profile model
model Profile {
  id        String       @id @default(cuid())

  userId    Int          @unique
  username  String       
  firstName String
  lastName  String

  status    UserStatus   @default(ONLINE)
  lastSeen  DateTime     @default(now())
  avatar    String        @default("testing.png")
  banner    String        @default("testing.png")
  bio       String        @default("Just here to have fun, level up, and make some epic memories!")
  

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  isVerified    Boolean    @default(false)
  walletBalance Int        @default(0)
  level         Int        @default(1)
  rankDivision  RankDivision @default(I)
  rankTier      RankTier   @default(BRONZE)



  // Relationships
  preferences         ProfilePreferences?
  playerStats         PlayerStats?
  playerCharacters   Json
 
  playerSelectedCharacter String
  playerPaddles Json @default("[\"WOODEN\"]")

  playerSelectedPaddle    String


  // Friendships
  sentFriendRequests     Friendship[] @relation("SentFriendRequests")
  receivedFriendRequests Friendship[] @relation("ReceivedFriendRequests")
}























// Profile preferences
model ProfilePreferences {
  id               String @id @default(cuid())
  profileId        String @unique

  soundEnabled     Boolean @default(true)
  musicEnabled     Boolean @default(true)
  twoFactorEnabled Boolean @default(false)

  profile       Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  notifications NotificationSettings?
}

// Notification settings
model NotificationSettings {
  id                String @id @default(cuid())
  preferencesId     String @unique

  friendRequests    Boolean @default(true)
  chatMessages      Boolean @default(true)
  gameInvites       Boolean @default(true)
  tournamentUpdates Boolean @default(true)

  preferences ProfilePreferences @relation(fields: [preferencesId], references: [id], onDelete: Cascade)
}

// Player statistics
model PlayerStats {
  id        String @id @default(cuid())
  profileId String @unique


  score Int @default(0)
  rank  Int @default(0)

  gamesPlayed Int @default(0)
  gamesWon    Int @default(0)
  gamesLost   Int @default(0)

  tournamentsPlayed Int @default(0)
  tournamentsWon    Int @default(0)
  tournamentsLost   Int @default(0)

  winStreak        Int @default(0)
  loseStreak       Int @default(0)
  longestWinStreak Int @default(0)

  averageGameDuration Int @default(0)
  totalPlayTime       Int @default(0)
  friendsCount        Int @default(0)

  bounceChallengeBestScore   Int @default(0)
  bounceChallengeGamesPlayed Int @default(0)

  profile   Profile     @relation(fields: [profileId], references: [id], onDelete: Cascade)
  vsAIStats VSAIStats[]
  
  
}

// AI statistics
model VSAIStats {
  id            String @id @default(cuid())
  playerStatsId String
  difficulty    AIDifficulty
  gamesPlayed   Int @default(0)
  gamesWon      Int @default(0)
  gamesLost     Int @default(0)

  playerStats PlayerStats @relation(fields: [playerStatsId], references: [id], onDelete: Cascade)

  @@unique([playerStatsId, difficulty])
}





// Match system
model Match {
  id          String @id @default(cuid())
  creatorId   String
  status      MatchStatus @default(WAITING)
  gameMode    GameMode
  startTime   DateTime?
  endTime     DateTime?
  winnerId    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profileHistory ProfileMatchHistory[]
}


// Profile match history junction
model ProfileMatchHistory {
  id        String @id @default(cuid())
  profileId String
  matchId   String
  result    MatchResult
  score     Int @default(0)

  match   Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([profileId, matchId])
}

// Tournament system
model Tournament {
  id          String @id @default(cuid())
  name        String
  description String?
  maxPlayers  Int
  prizePool   Int @default(0)
  status      TournamentStatus @default(REGISTRATION)
  startTime   DateTime
  endTime     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  entries TournamentEntry[]

}

model TournamentEntry {
  id           String @id @default(cuid())
  profileId    String
  tournamentId String
  position     Int?
  joinedAt     DateTime @default(now())

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([profileId, tournamentId])
}



// Friendship system
model Friendship {
  id        String @id @default(cuid())

  senderId  String
  receiverId String
  status    FriendshipStatus @default(PENDING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender   Profile @relation("SentFriendRequests", fields: [senderId], references: [id], onDelete: Cascade)
  receiver Profile @relation("ReceivedFriendRequests", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
}
