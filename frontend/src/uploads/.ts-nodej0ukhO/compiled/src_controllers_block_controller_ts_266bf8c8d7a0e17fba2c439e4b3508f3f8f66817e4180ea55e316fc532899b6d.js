"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.blockUserHandler = blockUserHandler;
exports.unblockUserHandler = unblockUserHandler;
exports.getBlockedUsersHandler = getBlockedUsersHandler;
const database_1 = __importDefault(require("../db/database"));
const utils_1 = require("../utils/utils");
async function blockUserHandler(req, res) {
    const respond = { success: true, message: 'user created success' };
    const headers = req.headers;
    const { blockId } = req.params;
    const userId = Number(headers['x-user-id']);
    let friendata = {};
    friendata['userId'] = userId;
    friendata['friendId'] = Number(blockId);
    friendata['status'] = 'accepted';
    try {
        friendata = await (0, utils_1.isFriendRequestExists)(friendata);
        if (!friendata)
            throw new Error("ready unblocked");
        const userId = friendata.userId;
        if (friendata.friendId == headers.id) {
            friendata.userId = friendata.friendId;
            friendata.friendId = userId;
            friendata.status = 'blocked';
        }
        await database_1.default.friendship.updateMany({
            where: {
                OR: [
                    { userId: friendata.userId, friendId: friendata.friendId },
                    { userId: friendata.friendId, friendId: friendata.userId }
                ]
            },
            data: friendata
        });
    }
    catch (error) {
        respond.success = false;
        if (error instanceof Error) {
            respond.message = error.message;
            return res.status(400).send(respond);
        }
    }
    return res.send(respond);
}
async function unblockUserHandler(req, res) {
    const respond = { success: true, message: 'user created success' };
    const { blockId } = req.params;
    const headers = req.headers;
    const userId = Number(headers['x-user-id']);
    let friendata = {};
    friendata['userId'] = userId;
    friendata['friendId'] = Number(blockId);
    friendata['status'] = 'blocked';
    try {
        friendata = await (0, utils_1.isFriendRequestExists)(friendata);
        if (!friendata)
            throw new Error("ready unblocked");
        if (friendata.userId != headers.id)
            throw new Error("not have pers for unblocked user not block him");
        await database_1.default.friendship.updateMany({
            where: {
                OR: [
                    { userId: friendata.userId, friendId: friendata.friendId },
                    { userId: friendata.friendId, friendId: friendata.userId }
                ]
            },
            data: { status: 'accepted' }
        });
    }
    catch (error) {
        respond.success = false;
        if (error instanceof Error) {
            respond.message = error.message;
            return res.status(400).send(respond);
        }
    }
    return res.send(respond);
}
async function getBlockedUsersHandler(req, res) {
    const respond = { success: true, message: 'user created success' };
    const headers = req.headers;
    const userId = Number(headers['x-user-id']);
    try {
        const blockedusers = await database_1.default.friendship.findMany({ where: { userId: userId, status: 'blocked' } });
        const friendIds = blockedusers.map((f) => f.friendId);
        const profiles = await database_1.default.profile.findMany({
            where: {
                id: { in: friendIds }
            }
        });
        respond.data = profiles;
    }
    catch (error) {
        respond.success = false;
        if (error instanceof Error) {
            respond.message = error.message;
            return res.status(400).send(respond);
        }
    }
    return res.send(respond);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL3VzZXIvc3JjL2NvbnRyb2xsZXJzL2Jsb2NrLmNvbnRyb2xsZXIudHMiLCJzb3VyY2VzIjpbIi91c2VyL3NyYy9jb250cm9sbGVycy9ibG9jay5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBWUEsNENBb0RDO0FBSUQsZ0RBOENDO0FBR0Qsd0RBK0JDO0FBbkpELDhEQUFvQztBQUNwQywwQ0FBdUQ7QUFVaEQsS0FBSyxVQUFVLGdCQUFnQixDQUFDLEdBQWtCLEVBQUcsR0FBZ0I7SUFFMUUsTUFBTSxPQUFPLEdBQXVCLEVBQUMsT0FBTyxFQUFHLElBQUksRUFBSSxPQUFPLEVBQUcsc0JBQXNCLEVBQUMsQ0FBQTtJQUV4RixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsT0FBYyxDQUFDO0lBQ25DLE1BQU0sRUFBQyxPQUFPLEVBQUMsR0FBRyxHQUFHLENBQUMsTUFBYSxDQUFDO0lBQ3BDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQTtJQUUzQyxJQUFJLFNBQVMsR0FBTyxFQUFFLENBQUM7SUFDdkIsU0FBUyxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sQ0FBQztJQUM3QixTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxVQUFVLENBQUM7SUFHakMsSUFDQSxDQUFDO1FBRUMsU0FBUyxHQUFHLE1BQU0sSUFBQSw2QkFBcUIsRUFBQyxTQUFTLENBQUMsQ0FBQztRQUNuRCxJQUFHLENBQUMsU0FBUztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUVwQyxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO1FBQ2hDLElBQUcsU0FBUyxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsRUFBRSxFQUNuQyxDQUFDO1lBQ0MsU0FBUyxDQUFDLE1BQU0s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Q2hDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDdEMsQ0FBQztJQUNMLENBQUM7SUFFRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7QUFFMUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZhc3RpZnlSZXF1ZXN0LCBGYXN0aWZ5UmVwbHkgfSBmcm9tICdmYXN0aWZ5JztcbmltcG9ydCBwcmlzbWEgZnJvbSAnLi4vZGIvZGF0YWJhc2UnO1xuaW1wb3J0IHsgaXNGcmllbmRSZXF1ZXN0RXhpc3RzIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xuXG5pbXBvcnQgeyBVc2VyUHJvZmlsZSB9IGZyb20gJy4uL3V0aWxzL3R5cGVzJztcbmltcG9ydCB7IEFwaVJlc3BvbnNlIH0gZnJvbSAnLi4vdXRpbHMvZXJyb3JIYW5kbGVyJztcblxuXG5cbiAgXG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGJsb2NrVXNlckhhbmRsZXIocmVxOkZhc3RpZnlSZXF1ZXN0ICwgcmVzOkZhc3RpZnlSZXBseSlcbntcbiAgY29uc3QgcmVzcG9uZCA6IEFwaVJlc3BvbnNlPG51bGw+ID0ge3N1Y2Nlc3MgOiB0cnVlICAsIG1lc3NhZ2UgOiAndXNlciBjcmVhdGVkIHN1Y2Nlc3MnfVxuXG4gIGNvbnN0IGhlYWRlcnMgPSByZXEuaGVhZGVycyBhcyBhbnk7XG4gIGNvbnN0IHtibG9ja0lkfSA9IHJlcS5wYXJhbXMgYXMgYW55O1xuICBjb25zdCB1c2VySWQgPSBOdW1iZXIoaGVhZGVyc1sneC11c2VyLWlkJ10pXG5cbiAgbGV0IGZyaWVuZGF0YTphbnkgPSB7fTtcbiAgZnJpZW5kYXRhWyd1c2VySWQnXSA9IHVzZXJJZDtcbiAgZnJpZW5kYXRhWydmcmllbmRJZCddID0gTnVtYmVyKGJsb2NrSWQpO1xuICBmcmllbmRhdGFbJ3N0YXR1cyddID0gJ2FjY2VwdGVkJztcbiAgXG5cbiAgdHJ5IFxuICB7XG5cbiAgICBmcmllbmRhdGEgPSBhd2FpdCBpc0ZyaWVuZFJlcXVlc3RFeGlzdHMoZnJpZW5kYXRhKTtcbiAgICBpZighZnJpZW5kYXRhKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwicmVhZHkgdW5ibG9ja2VkXCIpXG4gICAgXG4gICAgY29uc3QgdXNlcklkID0gZnJpZW5kYXRhLnVzZXJJZDtcbiAgICBpZihmcmllbmRhdGEuZnJpZW5kSWQgPT0gaGVhZGVycy5pZClcbiAgICB7XG4gICAgICBmcmllbmRhdGEudXNlcklkID0gZnJpZW5kYXRhLmZyaWVuZElkO1xuICAgICAgZnJpZW5kYXRhLmZyaWVuZElkID0gdXNlcklkO1xuICAgICAgZnJpZW5kYXRhLnN0YXR1cyA9ICdibG9ja2VkJ1xuICAgIH1cbiAgICBcblxuICAgIGF3YWl0IHByaXNtYS5mcmllbmRzaGlwLnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFtcbiAgICAgICAgICB7IHVzZXJJZDogZnJpZW5kYXRhLnVzZXJJZCwgZnJpZW5kSWQ6IGZyaWVuZGF0YS5mcmllbmRJZCB9LFxuICAgICAgICAgIHsgdXNlcklkOiBmcmllbmRhdGEuZnJpZW5kSWQsIGZyaWVuZElkOiBmcmllbmRhdGEudXNlcklkIH1cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIGRhdGE6IGZyaWVuZGF0YVxuICAgIH0pO1xuICAgIFxuICB9XG4gIGNhdGNoIChlcnJvcikgXG4gIHtcbiAgICByZXNwb25kLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcilcbiAgICAgIHtcbiAgICAgICAgcmVzcG9uZC5tZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHJlc3BvbmQpXG4gICAgICB9XG4gIH1cbiAgXG4gIHJldHVybiByZXMuc2VuZChyZXNwb25kKVxufVxuXG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tVc2VySGFuZGxlcihyZXE6RmFzdGlmeVJlcXVlc3QgLCByZXM6RmFzdGlmeVJlcGx5KVxue1xuICBjb25zdCByZXNwb25kIDogQXBpUmVzcG9uc2U8bnVsbD4gPSB7c3VjY2VzcyA6IHRydWUgICwgbWVzc2FnZSA6ICd1c2VyIGNyZWF0ZWQgc3VjY2Vzcyd9XG5cbiAgY29uc3Qge2Jsb2NrSWR9ID0gcmVxLnBhcmFtcyBhcyBhbnk7XG4gIGNvbnN0IGhlYWRlcnMgPSByZXEuaGVhZGVycyBhcyBhbnk7XG4gIGNvbnN0IHVzZXJJZCA9IE51bWJlcihoZWFkZXJzWyd4LXVzZXItaWQnXSlcblxuICBsZXQgZnJpZW5kYXRhOmFueSA9IHt9O1xuICBmcmllbmRhdGFbJ3VzZXJJZCddID0gdXNlcklkO1xuICBmcmllbmRhdGFbJ2ZyaWVuZElkJ10gPSBOdW1iZXIoYmxvY2tJZCk7XG4gIGZyaWVuZGF0YVsnc3RhdHVzJ10gPSAnYmxvY2tlZCc7XG4gIFxuXG4gIHRyeSBcbiAge1xuXG4gICAgZnJpZW5kYXRhID0gYXdhaXQgaXNGcmllbmRSZXF1ZXN0RXhpc3RzKGZyaWVuZGF0YSk7XG4gICAgaWYoIWZyaWVuZGF0YSlcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInJlYWR5IHVuYmxvY2tlZFwiKVxuICAgIFxuICAgIGlmKGZyaWVuZGF0YS51c2VySWQgIT0gaGVhZGVycy5pZClcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIm5vdCBoYXZlIHBlcnMgZm9yIHVuYmxvY2tlZCB1c2VyIG5vdCBibG9jayBoaW1cIilcblxuICAgIGF3YWl0IHByaXNtYS5mcmllbmRzaGlwLnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFtcbiAgICAgICAgICB7IHVzZXJJZDogZnJpZW5kYXRhLnVzZXJJZCwgZnJpZW5kSWQ6IGZyaWVuZGF0YS5mcmllbmRJZCB9LFxuICAgICAgICAgIHsgdXNlcklkOiBmcmllbmRhdGEuZnJpZW5kSWQsIGZyaWVuZElkOiBmcmllbmRhdGEudXNlcklkIH1cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIGRhdGE6IHtzdGF0dXMgOiAnYWNjZXB0ZWQnfVxuICAgIH0pO1xuICAgIFxuICB9XG4gIGNhdGNoIChlcnJvcikgXG4gIHtcbiAgICByZXNwb25kLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcilcbiAgICAgIHtcbiAgICAgICAgcmVzcG9uZC5tZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHJlc3BvbmQpXG4gICAgICB9XG4gIH1cbiAgXG4gIHJldHVybiByZXMuc2VuZChyZXNwb25kKVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRCbG9ja2VkVXNlcnNIYW5kbGVyKHJlcTpGYXN0aWZ5UmVxdWVzdCAsIHJlczpGYXN0aWZ5UmVwbHkpXG57XG4gIGNvbnN0IHJlc3BvbmQgOiBBcGlSZXNwb25zZTxVc2VyUHJvZmlsZVtdPiA9IHtzdWNjZXNzIDogdHJ1ZSAgLCBtZXNzYWdlIDogJ3VzZXIgY3JlYXRlZCBzdWNjZXNzJ31cblxuICBjb25zdCBoZWFkZXJzID0gcmVxLmhlYWRlcnMgYXMgYW55O1xuICBjb25zdCB1c2VySWQgPSBOdW1iZXIoaGVhZGVyc1sneC11c2VyLWlkJ10pXG5cbiAgdHJ5IFxuICB7XG4gIGNvbnN0IGJsb2NrZWR1c2VycyA9IGF3YWl0IHByaXNtYS5mcmllbmRzaGlwLmZpbmRNYW55KHt3aGVyZToge3VzZXJJZCA6IHVzZXJJZCAsIHN0YXR1czogJ2Jsb2NrZWQnfX0pO1xuICBjb25zdCBmcmllbmRJZHMgPSBibG9ja2VkdXNlcnMubWFwKChmOmFueSkgPT4gZi5mcmllbmRJZCk7XG5cbiAgY29uc3QgcHJvZmlsZXMgPSBhd2FpdCBwcmlzbWEucHJvZmlsZS5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7IGluOiBmcmllbmRJZHMgfVxuICAgIH1cbiAgfSlcbiAgcmVzcG9uZC5kYXRhID0gcHJvZmlsZXM7XG4gIH0gXG4gIGNhdGNoIChlcnJvcikgXG4gIHtcbiAgICByZXNwb25kLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcilcbiAgICAgIHtcbiAgICAgICAgcmVzcG9uZC5tZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHJlc3BvbmQpXG4gICAgICB9XG4gIH1cbiAgXG4gIHJldHVybiByZXMuc2VuZChyZXNwb25kKVxuICBcbn1cbiJdfQ==